import os
from data.loader import AShareDataLoader
from data.processor import FinancialFeatureEngineer
from train.train_sidecar import train_sidecar


def main():
    config = {
        'd_model': 128,
        'seq_len': 60,
        'mdd_horizon': 20,
        'batch_size': 512,
        'epochs': 10,
        'lr': 3e-4,
    }

    fe = FinancialFeatureEngineer(window_size=252)
    loader = AShareDataLoader(
        folder_path="data_source",
        seq_len=config['seq_len'],
        feature_engineer=fe
    )

    print("ğŸ“¥ åŠ è½½è‚¡ç¥¨æ•°æ®...")
    stocks = loader.load_all_csv(limit=100)

    if not stocks:
        raise RuntimeError("âŒ æœªåŠ è½½åˆ°æœ‰æ•ˆè‚¡ç¥¨æ•°æ®")

    os.makedirs("models", exist_ok=True)

    train_sidecar(stocks, config)


if __name__ == "__main__":
    main()
